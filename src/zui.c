#include <stdarg.h>
#include <string.h>
#include <stdlib.h>
#include "utils.h"
#include "zui.h"


#define ZUI_WIDTH  (640)
#define ZUI_HEIGHT (480)
#define MAX_ZUI_CMDS      (16)
#define OBJS_BUFFER_SIZE  (1024)

#define HBORDER_W (16)
#define HBORDER_H (7)

#define VBORDER_W (8)
#define VBORDER_H (20)

#define CHAR_W	  (7)
#define CHAR_H	  (7)
#define CHARSET_W (112)
#define CHARSET_H (21)
#define CHARS_PER_LINE (CHARSET_W / CHAR_W)




static const uint8_t hborder_data[] = (
	"\000\253\000\203\323\023\000G\000\000G\000\000G\000\000\253\000\000\253\000\005\005\005\005\005\005\005\005\005\000\253"
	"\000\000G\000\000G\000\005\005\005\005\005\005\005\005\005\203\323\023\000G\000\000G\000\203\323\023\000G\000\000\253"
	"\000\005\005\005\005\005\005\005\005\005\000\253\000\000G\000\000G\000\203\323\023\000\253\000\000\253\000\005\005\005\000"
	"G\000\000G\000\000G\000\000\253\000\203\323\023\000G\000\203\323\023\000\253\000\005\005\005\000\253\000\000"
	"G\000\203\323\023\000\253\000\000\253\000\005\005\005\000\253\000\005\005\005\000G\000\000\253\000\000\253\000\000"
	"\253\000\203\323\023\005\005\005\203\323\023\203\323\023\000G\000\203\323\023\000\253\000\000\253"
	"\000\005\005\005\000G\000\203\323\023\005\005\005\000\253\000\005\005\005\005\005\005\000\253\000\000\253\000\000\253"
	"\000\005\005\005\000\253\000\000G\000\000\253\000\000\253\000\005\005\005\203\323\023\000\253\000\005\005\005\005\005"
	"\005\005\005\005\203\323\023\000\253\000\005\005\005\000\253\000\000\253\000\005\005\005\005\005\005\203\323\023"
	"\000\253\000\005\005\005\005\005\005\000\253\000\000\253\000\005\005\005\005\005\005\000\253\000\000\253\000\005\005\005\005"
	"\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005" 
);
static const uint8_t vborder_data[] = (
	"\000G\000\000G\000\005\005\005\000G\000\203\323\023\000\253\000\005\005\005\000\253\000\005\005\005\203\323\023\000"
	"G\000\000G\000\000\253\000\000\253\000\203\323\023\203\323\023\000\253\000\000\253\000\000G\000\000\253"
	"\000\005\005\005\203\323\023\005\005\005\005\005\005\005\005\005\000G\000\000\253\000\000\253\000\005\005\005\000\253\000"
	"\000G\000\005\005\005\005\005\005\000\253\000\000G\000\203\323\023\000\253\000\000\253\000\000\253\000\000G\000\005"
	"\005\005\000\253\000\000G\000\000G\000\203\323\023\000\253\000\000\253\000\000\253\000\005\005\005\005\005\005\203"
	"\323\023\000G\000\203\323\023\000\253\000\005\005\005\005\005\005\005\005\005\203\323\023\000\253\000\000G\000"
	"\000G\000\203\323\023\000\253\000\005\005\005\005\005\005\203\323\023\000\253\000\000G\000\000\253\000\203"
	"\323\023\005\005\005\005\005\005\005\005\005\000\253\000\203\323\023\005\005\005\000\253\000\005\005\005\005\005\005\005"
	"\005\005\000\253\000\000\253\000\000\253\000\000\253\000\005\005\005\005\005\005\000G\000\005\005\005\005\005\005\005\005\005\203"
	"\323\023\000G\000\000\253\000\203\323\023\000G\000\000G\000\005\005\005\000G\000\000G\000\203\323\023\000\253"
	"\000\000\253\000\000G\000\005\005\005\000G\000\000G\000\000G\000\203\323\023\000\253\000\000G\000\000\253\000\005\005"
	"\005\005\005\005\005\005\005\000G\000\203\323\023\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\000G\000\000\253\000"
	"\203\323\023\005\005\005\005\005\005\005\005\005\005\005\005\000G\000\000\253\000\000\253\000\000\253\000\005\005\005\005"
	"\005\005\005\005\005\005\005\005\005\005\005\000\253\000\000G\000\005\005\005\203\323\023\005\005\005\005\005\005\005\005\005\000"
	"G\000\000\253\000\005\005\005\203\323\023\000G\000\000\253\000\000\253\000\000\253\000\000G\000\005\005\005\000G\000"
	"\000G\000\203\323\023\000\253\000\000\253\000\005\005\005"
);
static const uint8_t charset_data[] = (
	"\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\000\000\000\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\000"
	"\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000"
	"\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377"
	"\377\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000"
	"\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000"
	"\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377"
	"\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377"
	"\377\377\000\000\000\000\000\000\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000\000\000"
	"\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000"
	"\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000"
	"\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000"
	"\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000"
	"\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000"
	"\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000"
	"\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377"
	"\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000"
	"\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377"
	"\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000"
	"\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000"
	"\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000"
	"\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377"
	"\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000"
	"\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377"
	"\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000"
	"\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377"
	"\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000"
	"\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000"
	"\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000"
	"\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377"
	"\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\000\000\000"
	"\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000"
	"\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000"
	"\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377"
	"\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377"
	"\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000"
	"\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377"
	"\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377"
	"\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000"
	"\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000"
	"\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377"
	"\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000"
	"\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000"
	"\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000"
	"\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\000\000"
	"\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\005\005\005\005\005\005\005\005\005\005\005\005"
	"\005\005\005\005\005\005\005\005\005\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000"
	"\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000"
	"\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377"
	"\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\377\377\377\377\377\377\000\000\000\377\377\377\000\000\000\377\377\377\377\377"
	"\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000"
	"\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\005\005\005\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000"
	"\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377"
	"\377\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000\000"
	"\000\377\377\377\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377"
	"\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000"
	"\000\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000"
	"\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
);


typedef uint8_t zui_cmd_type;
enum zui_cmd_id {
	ZUI_CMD_TYPE_CLEAR,
	ZUI_CMD_TYPE_DRAW_BORDERS,
	ZUI_CMD_TYPE_DRAW_TEXT
};

struct zui_cmd {
	zui_obj_id_t obj_id;
	zui_cmd_type type;
};

struct text_obj {
	struct vec2i coord;
	int max_line_len;
	int max_lines;
	char str[];
};

static int zui_cmd_cnt = 0;
static struct zui_cmd zui_cmd_buffer[MAX_ZUI_CMDS];

static int objs_buffer_size = 0;
static uint8_t objs_buffer[OBJS_BUFFER_SIZE];



static void zui_cmd_push(zui_obj_id_t id, zui_cmd_type type)
{
	WLU_ASSERT(zui_cmd_cnt < MAX_ZUI_CMDS);
	zui_cmd_buffer[zui_cmd_cnt].obj_id = id;
	zui_cmd_buffer[zui_cmd_cnt].type = type;
	++zui_cmd_cnt;
}

static void zui_cmd_clear(void)
{
	zui_cmd_cnt = 0;
}

static zui_obj_id_t zui_obj_push(int size)
{
	WLU_ASSERT(objs_buffer_size + size <= OBJS_BUFFER_SIZE);
	zui_obj_id_t id = objs_buffer_size;
	objs_buffer_size += size;
	return id;
}

static void* zui_obj_get(zui_obj_id_t id)
{
	WLU_ASSERT(id < objs_buffer_size);
	return &objs_buffer[id];
}

static void zui_obj_clear(void)
{
	objs_buffer_size = 0;
}

static struct vec2i get_text_require_buffer_size_ex(int linelen, int lines)
{
	const int w =  (linelen * CHAR_W) + linelen;
	const int h = (lines * CHAR_H) + lines;
	return (struct vec2i) { .x = w, .y = h };
}

static struct vec2i get_text_required_buffer_size(const char* str)
{
	const int linelen = str_longest_line_len(str);
	const int lines = 1 + str_chr_cnt(str, '\n');
	return get_text_require_buffer_size_ex(linelen, lines);
}

static int get_text_max_str_size(int linelen, int lines)
{
	return (linelen * lines) + lines;
}

static void draw_borders(struct rgb24* dest) 
{
	const struct rgb24* hbord = (void*) hborder_data;
	const struct rgb24* vbord = (void*) vborder_data;
	const int w = ZUI_WIDTH;
	const int h = ZUI_HEIGHT;

	for (int i = 0; i < HBORDER_H; ++i) {
		for (int j = 0; j < w; ++j) {
			dest[i * w + j] = hbord[(i * HBORDER_W) + (j % HBORDER_W)];
			dest[((w * h) - HBORDER_H * w) + i * w + j] = hbord[(i * HBORDER_W) + (j % HBORDER_W)];
		}
	}

	for (int i = 0; i < h; ++i) {
		for (int j = 0; j < VBORDER_W; ++j) {
			dest[i * w + j] = vbord[((i % VBORDER_H) * VBORDER_W) + j];
			dest[(w - VBORDER_W) + i * w + j] = vbord[((i % VBORDER_H) * VBORDER_W) + j];
		}
	}
}



static void draw_text(
	zui_obj_id_t id,
	struct rgb24* framebuffer
)
{	
	const struct rgb24* cset = (void*)charset_data;

	const struct text_obj* obj = zui_obj_get(id);
	const size_t len = strlen(obj->str);
	
	const struct vec2i dest_size = get_text_required_buffer_size(obj->str);
	const struct vec2i clean_size = get_text_require_buffer_size_ex(
		obj->max_line_len, obj->max_lines
	);
	struct rgb24* dest_orig = 
		&framebuffer[obj->coord.y * ZUI_WIDTH + obj->coord.x];
	
	const char* str = obj->str;

	int dest_x = 0, dest_y = 0;
	int idx;
	char c;

	for (int y = 0; y < clean_size.y; ++y) {
		memset(
			dest_orig + y * ZUI_WIDTH,
			0x00,
			dest_size.x * sizeof(struct rgb24)
		);
	}

	for (int i = 0; i < len; ++i) {
		c = str[i];

		if (c >= 48 && c <= 57) {
			idx = c -= 48;
		} else if (c >= 65 && c <= 90) {
			idx = (c - 65) + 10;
		} else if (c >= 97 && c <= 122) {
			idx = (c - 97) + 10;
		} else if (c == '.') {
			idx = 40;
		} else if (c == ' ') {
			dest_x += CHAR_W + 1;
			if (dest_x >= dest_size.x)
				dest_x = 0;
			continue;

		} else if (c == '\n') {
			dest_y += CHAR_H + 1;
			dest_x = 0;
			continue;
		} else {
			continue;
		}

		const struct rgb24* const src = &cset[
			((idx / CHARS_PER_LINE) * CHAR_H * CHARSET_W) + 
			((idx % CHARS_PER_LINE) * CHAR_W)
		];
		
		struct rgb24* dest = dest_orig + (dest_y * ZUI_WIDTH) + dest_x;

		for (int cy = 0; cy < CHAR_H; ++cy) {
			for (int cx = 0; cx < CHAR_W; ++cx) {
				dest[(cy * ZUI_WIDTH) + cx] = src[(cy * CHARSET_W) + cx];
			}
		}

		dest_x += CHAR_W + 1;
		if (dest_x >= dest_size.x)
			dest_x = 0;
	}

}



void zui_init(void)
{
	zui_cmd_push(0, ZUI_CMD_TYPE_CLEAR);
	zui_cmd_push(0, ZUI_CMD_TYPE_DRAW_BORDERS);
}

void zui_term(void)
{
	zui_cmd_clear();
	zui_obj_clear();
}

zui_obj_id_t zui_text_create(
	int max_line_length,
	int max_lines,
	const struct vec2i coord
)
{
	const int len =  get_text_max_str_size(max_line_length, max_lines) + 1;
	const zui_obj_id_t id = zui_obj_push(sizeof(struct text_obj) + len);
	struct text_obj* obj = zui_obj_get(id);
	obj->coord = coord;
	obj->max_line_len = max_line_length;
	obj->max_lines = max_lines;
	return id;
}

void zui_text_set(const zui_obj_id_t id, const char* str)
{
	struct text_obj* obj = zui_obj_get(id);
	WLU_ASSERT(strlen(str) < get_text_max_str_size(obj->max_line_len, obj->max_lines));
	strcpy(obj->str, str);
	zui_cmd_push(id, ZUI_CMD_TYPE_DRAW_TEXT);
}

bool zui_update(struct rgb24* framebuffer)
{
	int i = 0;

	for (; i < zui_cmd_cnt; ++i) {
		switch (zui_cmd_buffer[i].type) {
		case ZUI_CMD_TYPE_CLEAR:
			memset(framebuffer, 0x00, sizeof(struct rgb24) * ZUI_WIDTH * ZUI_HEIGHT);
			break;
		case ZUI_CMD_TYPE_DRAW_BORDERS:
			draw_borders(framebuffer);
			break;
		case ZUI_CMD_TYPE_DRAW_TEXT:
			draw_text(zui_cmd_buffer[i].obj_id, framebuffer);
			break;
		}
	}

	if (i > 0) {
		zui_cmd_clear();
		return true;
	}

	return false;

}








