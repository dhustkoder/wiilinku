#include <stdarg.h>
#include <string.h>
#include <stdlib.h>
#include <assert.h>
#include "utils.h"
#include "zui.h"

#define HBORDER_W (16)
#define HBORDER_H (7)

#define VBORDER_W (8)
#define VBORDER_H (20)

#define CHAR_W	  (7)
#define CHAR_H	  (7)
#define CHARSET_W (112)
#define CHARSET_H (21)
#define CHARS_PER_LINE (CHARSET_W / CHAR_W)
#define MAX_BUFFER_OBJECTS  (16)
#define MAX_DYNAMIC_OBJECTS (16)


static const uint8_t hborder_data[] = (
	"\000\253\000\203\323\023\000G\000\000G\000\000G\000\000\253\000\000\253\000\005\005\005\005\005\005\005\005\005\000\253"
	"\000\000G\000\000G\000\005\005\005\005\005\005\005\005\005\203\323\023\000G\000\000G\000\203\323\023\000G\000\000\253"
	"\000\005\005\005\005\005\005\005\005\005\000\253\000\000G\000\000G\000\203\323\023\000\253\000\000\253\000\005\005\005\000"
	"G\000\000G\000\000G\000\000\253\000\203\323\023\000G\000\203\323\023\000\253\000\005\005\005\000\253\000\000"
	"G\000\203\323\023\000\253\000\000\253\000\005\005\005\000\253\000\005\005\005\000G\000\000\253\000\000\253\000\000"
	"\253\000\203\323\023\005\005\005\203\323\023\203\323\023\000G\000\203\323\023\000\253\000\000\253"
	"\000\005\005\005\000G\000\203\323\023\005\005\005\000\253\000\005\005\005\005\005\005\000\253\000\000\253\000\000\253"
	"\000\005\005\005\000\253\000\000G\000\000\253\000\000\253\000\005\005\005\203\323\023\000\253\000\005\005\005\005\005"
	"\005\005\005\005\203\323\023\000\253\000\005\005\005\000\253\000\000\253\000\005\005\005\005\005\005\203\323\023"
	"\000\253\000\005\005\005\005\005\005\000\253\000\000\253\000\005\005\005\005\005\005\000\253\000\000\253\000\005\005\005\005"
	"\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005" 
);
static const uint8_t vborder_data[] = (
	"\000G\000\000G\000\005\005\005\000G\000\203\323\023\000\253\000\005\005\005\000\253\000\005\005\005\203\323\023\000"
	"G\000\000G\000\000\253\000\000\253\000\203\323\023\203\323\023\000\253\000\000\253\000\000G\000\000\253"
	"\000\005\005\005\203\323\023\005\005\005\005\005\005\005\005\005\000G\000\000\253\000\000\253\000\005\005\005\000\253\000"
	"\000G\000\005\005\005\005\005\005\000\253\000\000G\000\203\323\023\000\253\000\000\253\000\000\253\000\000G\000\005"
	"\005\005\000\253\000\000G\000\000G\000\203\323\023\000\253\000\000\253\000\000\253\000\005\005\005\005\005\005\203"
	"\323\023\000G\000\203\323\023\000\253\000\005\005\005\005\005\005\005\005\005\203\323\023\000\253\000\000G\000"
	"\000G\000\203\323\023\000\253\000\005\005\005\005\005\005\203\323\023\000\253\000\000G\000\000\253\000\203"
	"\323\023\005\005\005\005\005\005\005\005\005\000\253\000\203\323\023\005\005\005\000\253\000\005\005\005\005\005\005\005"
	"\005\005\000\253\000\000\253\000\000\253\000\000\253\000\005\005\005\005\005\005\000G\000\005\005\005\005\005\005\005\005\005\203"
	"\323\023\000G\000\000\253\000\203\323\023\000G\000\000G\000\005\005\005\000G\000\000G\000\203\323\023\000\253"
	"\000\000\253\000\000G\000\005\005\005\000G\000\000G\000\000G\000\203\323\023\000\253\000\000G\000\000\253\000\005\005"
	"\005\005\005\005\005\005\005\000G\000\203\323\023\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\000G\000\000\253\000"
	"\203\323\023\005\005\005\005\005\005\005\005\005\005\005\005\000G\000\000\253\000\000\253\000\000\253\000\005\005\005\005"
	"\005\005\005\005\005\005\005\005\005\005\005\000\253\000\000G\000\005\005\005\203\323\023\005\005\005\005\005\005\005\005\005\000"
	"G\000\000\253\000\005\005\005\203\323\023\000G\000\000\253\000\000\253\000\000\253\000\000G\000\005\005\005\000G\000"
	"\000G\000\203\323\023\000\253\000\000\253\000\005\005\005"
);
static const uint8_t charset_data[] = (
	"\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\000\000\000\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\000"
	"\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000"
	"\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377"
	"\377\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000"
	"\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000"
	"\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377"
	"\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377"
	"\377\377\000\000\000\000\000\000\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000\000\000"
	"\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000"
	"\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000"
	"\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000"
	"\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000"
	"\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000"
	"\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000"
	"\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377"
	"\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000"
	"\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377"
	"\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000"
	"\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000"
	"\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000"
	"\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377"
	"\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000"
	"\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377"
	"\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000"
	"\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377"
	"\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000"
	"\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000"
	"\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000"
	"\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377"
	"\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\000\000\000"
	"\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000"
	"\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000"
	"\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377"
	"\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377"
	"\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000"
	"\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377"
	"\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377"
	"\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000"
	"\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000"
	"\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377"
	"\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000"
	"\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000"
	"\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000"
	"\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\000\000"
	"\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\005\005\005\005\005\005\005\005\005\005\005\005"
	"\005\005\005\005\005\005\005\005\005\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000"
	"\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000"
	"\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377"
	"\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\377\377\377\377\377\377\000\000\000\377\377\377\000\000\000\377\377\377\377\377"
	"\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000"
	"\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\005\005\005\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000"
	"\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377"
	"\377\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000\000"
	"\000\377\377\377\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377"
	"\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000"
	"\000\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000"
	"\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
);

struct buffer_object {
	struct recti rect;
	unsigned long long buffer_idx;
};


static int buffer_objs_cnt;
static struct buffer_object buffer_objs[MAX_BUFFER_OBJECTS];

static unsigned long long workbuffer_byte_cnt = 0;
static void* workbuffer = NULL;

static struct vec2i targetbuffer_size = { 0, 0 };
static void* targetbuffer = NULL;


static void* workbuffer_idx_to_ptr(unsigned long long idx)
{
	assert(workbuffer != NULL);
	return (((unsigned char*)workbuffer) + idx);
}

static unsigned long long workbuffer_size_add(struct vec2i size)
{
	unsigned long long idx = workbuffer_byte_cnt;
	workbuffer_byte_cnt += size.x * size.y * 3;
	workbuffer = realloc(workbuffer, workbuffer_byte_cnt);
	assert(workbuffer != NULL);
	return idx;
}

static void draw_text(
	const char* str,
	const int len,
	struct rgb24* dest_orig,
	const struct vec2i dest_size
)
{

	const struct rgb24* cset = (void*)charset_data;
	
	int dest_x = 0, dest_y = 0;
	int idx;
	char c;

	memset(dest_orig, 0x00, dest_size.x * dest_size.y * 3);

	for (int i = 0; i < len; ++i) {
		c = str[i];

		if (c >= 48 && c <= 57) {
			idx = c -= 48;
		} else if (c >= 65 && c <= 90) {
			idx = (c - 65) + 10;
		} else if (c >= 97 && c <= 122) {
			idx = (c - 97) + 10;
		} else if (c == '.') {
			idx = 40;
		} else if (c == ' ') {
			dest_x += CHAR_W + 1;
			if (dest_x >= dest_size.x)
				dest_x = 0;
			continue;

		} else if (c == '\n') {
			dest_y += CHAR_H + 1;
			dest_x = 0;
			continue;
		} else {
			continue;
		}

		const struct rgb24* const src = &cset[
			((idx / CHARS_PER_LINE) * CHAR_H * CHARSET_W) + 
			((idx % CHARS_PER_LINE) * CHAR_W)
		];
		
		struct rgb24* dest = dest_orig + (dest_y * dest_size.x) + dest_x;

		for (int cy = 0; cy < CHAR_H; ++cy) {
			for (int cx = 0; cx < CHAR_W; ++cx) {
				dest[(cy * dest_size.x) + cx] = src[(cy * CHARSET_W) + cx];
			}
		}

		dest_x += CHAR_W + 1;
		if (dest_x >= dest_size.x)
			dest_x = 0;
	}

}

static void pixel_copy(
  struct rgb24* dest,
  const struct rgb24* src,
  struct vec2i dest_size,
  struct recti src_rect
)
{
	dest += src_rect.coord.y * dest_size.x + src_rect.coord.x;
	for (int y = 0; y < src_rect.size.y; ++y) {
		memcpy(dest, src, src_rect.size.x * 3);
		dest += dest_size.x;
		src += src_rect.size.x;
	}
}

static struct vec2i get_text_require_buffer_size_ex(int linelen, int lines)
{
	const int w =  (linelen * CHAR_W) + linelen;
	const int h = (lines * CHAR_H) + lines;
	return (struct vec2i) { .x = w, .y = h };
}

static struct vec2i get_text_required_buffer_size(const char* str)
{
	const int linelen = str_longest_line_len(str);
	const int lines = 1 + str_chr_cnt(str, '\n');
	return get_text_require_buffer_size_ex(linelen, lines);
}



bool zui_init(const char* title, void* framebuffer, int w, int h)
{
	assert(title != NULL && framebuffer != NULL && w >= 480 && h >= 360);

	targetbuffer = framebuffer;
	targetbuffer_size.x = w;
	targetbuffer_size.y = h;

	struct rgb24* dest = framebuffer;
	const struct rgb24* hbord = (void*)hborder_data;
	const struct rgb24* vbord = (void*)vborder_data;
	
	for (int i = 0; i < HBORDER_H; ++i) {
		for (int j = 0; j < w; ++j) {
			dest[i * w + j] = hbord[(i * HBORDER_W) + (j % HBORDER_W)];
			dest[((w * h) - HBORDER_H * w) + i * w + j] = hbord[(i * HBORDER_W) + (j % HBORDER_W)];
		}
	}

	for (int i = 0; i < h; ++i) {
		for (int j = 0; j < VBORDER_W; ++j) {
			dest[i * w + j] = vbord[((i % VBORDER_H) * VBORDER_W) + j];
			dest[(w - VBORDER_W) + i * w + j] = vbord[((i % VBORDER_H) * VBORDER_W) + j];
		}
	}

	zui_static_text_create(0, title, (struct vec2i){ .x = w / 2, VBORDER_H + 14});

	return true;
}

void zui_term(void)
{
	free(workbuffer);
}

int zui_static_text_create(int winid, const char* str, struct vec2i origin)
{
	assert(
		buffer_objs_cnt < MAX_BUFFER_OBJECTS && 
		str != NULL &&
		origin.x >= 0 &&
		origin.y >= 0
	);

	const int id = buffer_objs_cnt++;

	const struct vec2i size = get_text_required_buffer_size(str);

	const struct vec2i coord = { 
		.x = origin.x - (size.x / 2), 
		.y = origin.y - (size.y / 2)
	};

	buffer_objs[id].rect = (struct recti) {
		.coord = coord,
		.size = size
	};

	buffer_objs[id].buffer_idx = workbuffer_size_add(
		buffer_objs[id].rect.size
	);

	draw_text(
		str,
		strlen(str),
		workbuffer_idx_to_ptr(buffer_objs[id].buffer_idx),
		buffer_objs[id].rect.size
	);

	return id;
}

int zui_dynamic_text_create(
	int winid,
	int max_line_len,
	int max_lines
)
{
	assert(
		buffer_objs_cnt < MAX_BUFFER_OBJECTS &&
		max_line_len > 0 &&
		max_lines > 0
	);

	const int id = buffer_objs_cnt++;

	const struct vec2i size = get_text_require_buffer_size_ex(max_line_len, max_lines);
	const unsigned long long buffer_idx = workbuffer_size_add(size);
	memset(workbuffer_idx_to_ptr(buffer_idx), 0, size.x * size.y * 3);

	buffer_objs[id] = (struct buffer_object) {
		.buffer_idx = buffer_idx,
		.rect = (struct recti) {
			.coord = {0, 0},
			.size = size
		}
	};

	return id;
}

void zui_dynamic_text_set(int obj_id, const char* str, struct vec2i origin)
{
	assert(obj_id < buffer_objs_cnt && str != NULL && origin.x >= 0 && origin.y >= 0);

	struct buffer_object* obj = &buffer_objs[obj_id];

	const struct vec2i size = get_text_required_buffer_size(str);
	// assert(obj->rect.size.x >= size.x && obj->rect.size.y >= size.y);

	obj->rect.coord = (struct vec2i) {
		.x = origin.x - (size.x / 2),
		.y = origin.y - (size.y / 2)
	};
	obj->rect.size = size; // FIXME

	draw_text(
		str,
		strlen(str),
		workbuffer_idx_to_ptr(obj->buffer_idx),
		size
	);
}

void zui_update(void)
{

}

void zui_render(void)
{
	for (int i = 0; i < buffer_objs_cnt; ++i) {
		struct buffer_object* obj = &buffer_objs[i];
		pixel_copy(
			targetbuffer,
			workbuffer_idx_to_ptr(obj->buffer_idx),
			targetbuffer_size,
			obj->rect
		);
	}
}







