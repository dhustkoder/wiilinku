#include <stdarg.h>
#include <string.h>
#include <stdlib.h>
#include <assert.h>
#include "utils.h"
#include "zui.h"

#define HBORDER_W (16)
#define HBORDER_H (7)

#define VBORDER_W (8)
#define VBORDER_H (20)

#define CHAR_W	  (7)
#define CHAR_H	  (7)
#define CHARSET_W (112)
#define CHARSET_H (21)
#define CHARS_PER_LINE (CHARSET_W / CHAR_W)
#define MAX_BUFFER_OBJECTS (512)


static const uint8_t hborder_data[] = (
	"\000\253\000\203\323\023\000G\000\000G\000\000G\000\000\253\000\000\253\000\005\005\005\005\005\005\005\005\005\000\253"
	"\000\000G\000\000G\000\005\005\005\005\005\005\005\005\005\203\323\023\000G\000\000G\000\203\323\023\000G\000\000\253"
	"\000\005\005\005\005\005\005\005\005\005\000\253\000\000G\000\000G\000\203\323\023\000\253\000\000\253\000\005\005\005\000"
	"G\000\000G\000\000G\000\000\253\000\203\323\023\000G\000\203\323\023\000\253\000\005\005\005\000\253\000\000"
	"G\000\203\323\023\000\253\000\000\253\000\005\005\005\000\253\000\005\005\005\000G\000\000\253\000\000\253\000\000"
	"\253\000\203\323\023\005\005\005\203\323\023\203\323\023\000G\000\203\323\023\000\253\000\000\253"
	"\000\005\005\005\000G\000\203\323\023\005\005\005\000\253\000\005\005\005\005\005\005\000\253\000\000\253\000\000\253"
	"\000\005\005\005\000\253\000\000G\000\000\253\000\000\253\000\005\005\005\203\323\023\000\253\000\005\005\005\005\005"
	"\005\005\005\005\203\323\023\000\253\000\005\005\005\000\253\000\000\253\000\005\005\005\005\005\005\203\323\023"
	"\000\253\000\005\005\005\005\005\005\000\253\000\000\253\000\005\005\005\005\005\005\000\253\000\000\253\000\005\005\005\005"
	"\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005" 
);
static const uint8_t vborder_data[] = (
	"\000G\000\000G\000\005\005\005\000G\000\203\323\023\000\253\000\005\005\005\000\253\000\005\005\005\203\323\023\000"
	"G\000\000G\000\000\253\000\000\253\000\203\323\023\203\323\023\000\253\000\000\253\000\000G\000\000\253"
	"\000\005\005\005\203\323\023\005\005\005\005\005\005\005\005\005\000G\000\000\253\000\000\253\000\005\005\005\000\253\000"
	"\000G\000\005\005\005\005\005\005\000\253\000\000G\000\203\323\023\000\253\000\000\253\000\000\253\000\000G\000\005"
	"\005\005\000\253\000\000G\000\000G\000\203\323\023\000\253\000\000\253\000\000\253\000\005\005\005\005\005\005\203"
	"\323\023\000G\000\203\323\023\000\253\000\005\005\005\005\005\005\005\005\005\203\323\023\000\253\000\000G\000"
	"\000G\000\203\323\023\000\253\000\005\005\005\005\005\005\203\323\023\000\253\000\000G\000\000\253\000\203"
	"\323\023\005\005\005\005\005\005\005\005\005\000\253\000\203\323\023\005\005\005\000\253\000\005\005\005\005\005\005\005"
	"\005\005\000\253\000\000\253\000\000\253\000\000\253\000\005\005\005\005\005\005\000G\000\005\005\005\005\005\005\005\005\005\203"
	"\323\023\000G\000\000\253\000\203\323\023\000G\000\000G\000\005\005\005\000G\000\000G\000\203\323\023\000\253"
	"\000\000\253\000\000G\000\005\005\005\000G\000\000G\000\000G\000\203\323\023\000\253\000\000G\000\000\253\000\005\005"
	"\005\005\005\005\005\005\005\000G\000\203\323\023\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\000G\000\000\253\000"
	"\203\323\023\005\005\005\005\005\005\005\005\005\005\005\005\000G\000\000\253\000\000\253\000\000\253\000\005\005\005\005"
	"\005\005\005\005\005\005\005\005\005\005\005\000\253\000\000G\000\005\005\005\203\323\023\005\005\005\005\005\005\005\005\005\000"
	"G\000\000\253\000\005\005\005\203\323\023\000G\000\000\253\000\000\253\000\000\253\000\000G\000\005\005\005\000G\000"
	"\000G\000\203\323\023\000\253\000\000\253\000\005\005\005"
);
static const uint8_t charset_data[] = (
	"\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\000\000\000\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\000"
	"\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000"
	"\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377"
	"\377\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000"
	"\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000"
	"\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377"
	"\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377"
	"\377\377\000\000\000\000\000\000\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000\000\000"
	"\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000"
	"\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000"
	"\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000"
	"\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000"
	"\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000"
	"\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000"
	"\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377"
	"\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000"
	"\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377"
	"\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000"
	"\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000"
	"\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000"
	"\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377"
	"\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000"
	"\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377"
	"\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000"
	"\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377"
	"\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000"
	"\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000"
	"\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000"
	"\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377"
	"\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\000\000\000"
	"\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000"
	"\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000"
	"\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377"
	"\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377"
	"\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000"
	"\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377"
	"\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377"
	"\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000"
	"\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000"
	"\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377"
	"\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\000\000"
	"\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000"
	"\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000"
	"\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377"
	"\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\000\000"
	"\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\005\005\005\005\005\005\005\005\005\005\005\005"
	"\005\005\005\005\005\005\005\005\005\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000"
	"\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000"
	"\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\005\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377"
	"\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\377\377\377\377\377\377\000\000\000\377\377\377\000\000\000\377\377\377\377\377"
	"\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000"
	"\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\000"
	"\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\005\005\005\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000"
	"\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377"
	"\377\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\377\377\377\377\377\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\377\000\000\000\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377"
	"\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000\000"
	"\000\377\377\377\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\000\000\000\377\377"
	"\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000"
	"\000\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000"
	"\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377"
	"\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377"
	"\377\377\377\000\000\000\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\377\377"
	"\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
	"\377\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377"
	"\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\377\377\377\377\377\377\377\377\377\000\000\000\377\377\377\377\377\377"
	"\000\000\000\000\000\000\377\377\377\377\377\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\377\377\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
	"\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
);

struct buffer_object {
	struct recti rect;
	unsigned long long buffer_idx;
};

static int buffer_objs_cnt;
static struct buffer_object buffer_objs[MAX_BUFFER_OBJECTS];

static unsigned long long workbuffer_byte_cnt = 0;
static void* workbuffer = NULL;

static struct size2i targetbuffer_size = { 0, 0 };
static void* targetbuffer = NULL;


static void zui_text_render(
	const char* str,
	const int len,
	struct rgb24* dest_orig,
	const struct size2i dest_size
)
{

	const struct rgb24* cset = (void*)charset_data;
	
	int dest_x = 0, dest_y = 0;
	int idx;
	char c;

	memset(dest_orig, 0x00, dest_size.w * dest_size.h * 3);

	for (int i = 0; i < len; ++i) {
		c = str[i];

		if (c >= 48 && c <= 57) {
			idx = c -= 48;
		} else if (c >= 65 && c <= 90) {
			idx = (c - 65) + 10;
		} else if (c >= 97 && c <= 122) {
			idx = (c - 97) + 10;
		} else if (c == ' ') {
			dest_x += CHAR_W + 1;
			if (dest_x >= dest_size.w)
				dest_x = 0;
			continue;
		} else if (c == '\n') {
			dest_y += CHAR_H + 1;
			dest_x = 0;
			continue;
		} else {
			continue;
		}

		const struct rgb24* const src = &cset[
			((idx / CHARS_PER_LINE) * CHAR_H * CHARSET_W) + 
			((idx % CHARS_PER_LINE) * CHAR_W)
		];
		
		struct rgb24* dest = dest_orig + (dest_y * dest_size.w) + dest_x;

		for (int cy = 0; cy < CHAR_H; ++cy) {
			for (int cx = 0; cx < CHAR_W; ++cx) {
				dest[(cy * dest_size.w) + cx] = src[(cy * CHARSET_W) + cx];
			}
		}

		dest_x += CHAR_W + 1;
		if (dest_x >= dest_size.w)
			dest_x = 0;
	}

}

static void* workbuffer_idx_to_ptr(unsigned long long idx)
{
	assert(idx >= 0 && workbuffer != NULL);
	return (((unsigned char*)workbuffer) + idx);
}

static void zui_pixcpy(
  struct rgb24* dest,
  const struct rgb24* src,
  struct size2i dest_size,
  struct recti src_rect
)
{
	dest += src_rect.y * dest_size.w + src_rect.x;
	for (int y = 0; y < src_rect.h; ++y) {
		memcpy(dest, src, src_rect.w * 3);
		dest += dest_size.w;
		src += src_rect.w;
	}
}

static struct size2i get_text_required_buffer_size(const char* str)
{
	const int linelen = str_longest_line_len(str);
	const int lines = 1 + str_chr_cnt(str, '\n');
	const int w =  (linelen * CHAR_W) + linelen;
	const int h = (lines * CHAR_H) + lines;

	return (struct size2i){ w, h };
}



int zui_init(void* fb, int w, int h)
{
	assert(fb != NULL && w >= 480 && h >= 360);

	targetbuffer = fb;
	targetbuffer_size.w = w;
	targetbuffer_size.h = h;

	struct rgb24* dest = fb;
	const struct rgb24* hbord = (void*)hborder_data;
	const struct rgb24* vbord = (void*)vborder_data;
	
	for (int i = 0; i < HBORDER_H; ++i) {
		for (int j = 0; j < w; ++j) {
			dest[i * w + j] = hbord[(i * HBORDER_W) + (j % HBORDER_W)];
			dest[((w * h) - HBORDER_H * w) + i * w + j] = hbord[(i * HBORDER_W) + (j % HBORDER_W)];
		}
	}

	for (int i = 0; i < h; ++i) {
		for (int j = 0; j < VBORDER_W; ++j) {
			dest[i * w + j] = vbord[((i % VBORDER_H) * VBORDER_W) + j];
			dest[(w - VBORDER_W) + i * w + j] = vbord[((i % VBORDER_H) * VBORDER_W) + j];
		}
	}

	return 0;
}

void zui_term(void)
{

}

int zui_static_text_create(int winid, const char* str, struct vec2i origin)
{
	assert(
		buffer_objs_cnt < MAX_BUFFER_OBJECTS && 
		str != NULL &&
		origin.x >= 0 &&
		origin.y >= 0
	);

	const int id = buffer_objs_cnt++;

	struct size2i size = get_text_required_buffer_size(str);

	const int x = origin.x - (size.w / 2);
	const int y = origin.y - (size.h / 2);

	buffer_objs[id].rect = (struct recti) {
		x, y, size.w, size.h
	};
	buffer_objs[id].buffer_idx = workbuffer_byte_cnt;

	workbuffer_byte_cnt += size.w * size.h * 3;
	workbuffer = realloc(workbuffer, workbuffer_byte_cnt);
	assert(workbuffer != NULL);

	zui_text_render(
		str,
		strlen(str),
		workbuffer_idx_to_ptr(buffer_objs[id].buffer_idx),
		(struct size2i){ 
			.w = buffer_objs[id].rect.w, 
			.h = buffer_objs[id].rect.h
		}
	);

	return id;
}

void zui_update(void)
{

}

void zui_render(void)
{
	for (int i = 0; i < buffer_objs_cnt; ++i) {
		struct buffer_object* obj = &buffer_objs[i];
		zui_pixcpy(
			targetbuffer,
			workbuffer_idx_to_ptr(obj->buffer_idx),
			targetbuffer_size,
			obj->rect
		);
	}
}







